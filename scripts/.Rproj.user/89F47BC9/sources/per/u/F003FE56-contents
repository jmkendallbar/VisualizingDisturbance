---
title: "Narwhal_Data_Wrangling"
author: "Jessica Kendall-Bar"
date: "5/18/2021"
output: html_document
---

```{r include = FALSE}
library(here)
library(lubridate)
library(tidyr)
library(dplyr)
library(ggplot2)
library(janitor)
```

## Narwhal Data Wrangling

This `RMarkdown` document explains the steps to get the Heart Rate data into Python.

```{r Load in data}
HR_data  <- read.csv(here("data","narwhal_HR.csv"))
```

## Inspecting the data

Previewing the dataset and inspecting each element.

```{r echo=FALSE}
# Preview the dataset and the class types
head(HR_data,10)
```
```{r pressure, echo=FALSE}

startsec <- 0
endsec   <- 200

fs <- 25

HR_subset <- HR_data %>% filter(Seconds > startsec) %>% filter(Seconds<endsec)

for (i in 1:nrow(HR_subset)) {
  HR_subset$Interval[i] <- HR_subset$Seconds[i+1] - HR_subset$Seconds[i]
}
HR_subset <- na.omit(HR_subset)
paste("Shortest interbeat interval is ", min(HR_subset$Interval))
paste("Longest interbeat interval is ", max(HR_subset$Interval))

HR_subset$Wait <- HR_subset$Interval - 0.30
```

```{r}
#Write csv file - use this CSV to import annotations into EDF file
write.csv(HR_subset$Interval, here("data", "HR_data_for_Python.csv"), sep=",", col.names = TRUE, row.names = FALSE)
write.csv(HR_subset$Wait, here("data","HR_wait_for_Python.csv"), sep=",", col.names = TRUE, row.names = FALSE)
```

```{r plot}
HR_forPlot <- HR_data %>% filter(Seconds > startsec) %>% filter(Seconds<endsec)

plot1 <- ggplot(HR_forPlot, aes(x=Seconds,y=InHR))+
           geom_line()+
           theme_classic()
           
plot1+labs(
  title = "Instananeous HR over time (bpm)",
  x= "Time (seconds)",
  y= "Instantaneous HR (bpm)",
  caption = "Figure by Jessica Kendall-Bar"
)
```

```{r}
HR_forPlot <- HR_data %>% filter(Seconds > startsec) %>% filter(Seconds<endsec)

plot1 <- ggplot(HR_forPlot, aes(x=Seconds,y=InHR))+
           geom_line()+
           theme_classic()
           
plot1+labs(
  title = "Instananeous HR over time (bpm)",
  x= "Time (seconds)",
  y= "Instantaneous HR (bpm)",
  caption = "Figure by Jessica Kendall-Bar"
)
```